Шаблонизация
- [Использование](#Использование_шаблонизации)
- [Шаблон](#Шаблон)
  - [синтаксис](#Синтаксис_шаблона)
  - [методы храниения](#Методы_хранения)
  - [использование](#Использование_шаблона)
- [Хелперы](#Helpers)
------------
- [Альтернативные источники](#Альтернативные_источники)
------------

### Шаблонизация (Templating) – это метод связывания данных на стороне клиента. 

Генерации HTML-разметки по «шаблону» и данным и дальнейшая подстановка.  

Суть шаблонизации заключается в том, чтобы **отделить разметку страницы от программного кода**.
Разметка помещается в **отдельные файлы (шаблоны)**, в местах, где необходимо вывести данные размещаются специальные псевдопеременные. 
Сценарий загружает нужный шаблон и заменяет в нем псевдопеременные на соответствующие данные.

### Использование шаблонизации

Весь процесс требует нескольких простых шагов. 
**Наличие данных** ( data ) которыми будет наполнятся элемент интерфейса. 
**Шаблон** ( template ) по которому будет составлена разметка элемента
**Библиотека** которая предоставляет средства шаблонизации ( template engine). 
В результате мы получим HTML разметку.

#### По шагам
1. Подключить в проект выбраную библиотеку для шаблонизации
2. Составить HTML шаблон необходимого вида
3. Сделать выборку нашего шаблона в скрипте
4. Произвести рендеринг шаблона вместе с данными

### Шаблон

**Шаблон – это строка в специальном формате**, которая путём подстановки значений и выполнения встроенных фрагментов кода превращается в HTML.
**Это обычный HTML, с вставками вида {{...}},** это синтаксис Handlebars-шаблона.

Синтаксис шаблона у каждой библиотеке разный

```javascript
<div class="menu">
  <h3 class="menu-title">{{title}}</h3>
  <ul class="menu-list">
    {{#each items}}
      <li class="menu-item">{{this}}</li>
    {{/each}}
  </ul>
</div>
```
####  Синтаксис_шаблона

Шаблон представляет собой **строку** со специальными **разделителями**, которых в Hanelbars всего два

**{{expr}}** – expr между разделителями будет выполнен **«как есть»**, то есть вместо имени переменной будет подставлено ее значение, при этом **если** переменная содержит **строку с тегами**, то **не произойдет парса** строки.

**{{{expr}}}** – используется **для вставки html-тегов**, если expr = `<p>text</p>` то вставится именно тег абзаца.

**{{#helper}} ....code {{/helper}}** - используется для **встроенных и кастомных операций**, к примеру each работает как forEach, перебирая коллекцию, а в теле each к элементу коллекции можно обратиться как this.


#### Методы_хранения

Код шаблона хранится в теге <template>. Браузер НЕ РЕНДЕРИИТ тег <template>.

```html
<template id="menu">
  <div class="menu">
    <h3 class="menu-title">{{title}}</h3>
    <ul class="menu-list">
      {{#each items}}
        <li class="menu-item">{{this}}</li>
      {{/each}}
    </ul>
  </div>
</template>
```


Большинство библиотек **поддерживают** как **встроенные**, так и **внешние** шаблоны. 

**Встроенные** шаблоны **подходят**, **когда** у нас очень **мало шаблонов**, или мы знаем, что мы будем использовать включенные шаблоны при загрузке каждой страницы, но обычно наши шаблоны должны быть внешними.

**Внешние** шаблоны имеют много преимуществ, главным образом в том, что шаблоны никогда не будут загружаться клиенту, если они не нужны на странице. 

### Использование_шаблона

#### 1) Добавить в проект бибилиотеку

1 способ - Скачиваем файл библиотеки и подключить его в index.html
2 способ - CDN сервис, линкуем в <head>
3 способ - поставить библиотеку как npm- пакет

Установка [Handlebars](https://handlebarsjs.com/installation.html)

Ссылки [СDN](https://cdnjs.com/libraries/handlebars.js) 


Перед закрывающим тегом body и перед нашим файлом скриптов, добавить еще один тег script.
```javascript
<script src="https://cdnjs.cloudflare.com/ajax/libs/handlebars.js/4.0.12/handlebars.min.js"></script>
```

#### 2) Составить HTML шаблон необходимого вида

Составить необходимую HTML разметку и проставить "окна вывода"

#### 3) Сделать выборку шаблона в скрипте

Отбираем по селектору тег родитель <template> в котором хранится нужная нам разметка. 
В {{javascript переменная}}, в скобки подставляем те данные которые нам нужны.(значения переменных, объектов,функций и т.п)

```javascript
<template id="menu-template">
  <div class="menu">
    <h3 class="menu-title">{{title}}</h3>
    <ul class="menu-list">
      {{#each items}}
        <li class="menu-item">{{this}}</li>
      {{/each}}
    </ul>
  </div>
</template>
```

Далее вытягиваем из него размеку через .innerHTML , затем обрезаем лишние пробелы меодом .trim()

```javascript
const source = document.querySelector('#menu-template').innerHTML.trim();
```

#### 4) Произвести рендеринг шаблона с данными

Для работы с шаблоном в библиотеке Handlebars есть функция compile. Эта функция запускает «компиляцию» шаблона source и возвращает результат в виде функции, которую далее можно запустить с данными и получить строку-результат.

```javascript
Handlebars.compile(source)
```

Вызов **Handlebars.compile(source)** разбивает html-строку по разделителям и, при помощи new Function создаёт на её основе JavaScript-функцию. 
Тело этой функции создаётся таким образом, что код, который в шаблоне оформлен как {{...}} – попадает в неё «как есть», а переменные и текст прибавляются к специальному временному «буферу», который в итоге возвращается.

```javascript
// объект с данными, которые будем использовать
const menuData = {
  title: 'Eat it createElement, templates rule!',
  items: ['Handlebars', 'LoDash', 'Pug', 'EJS', 'lit-html']
};

// отбираем нужную разметку
const source = document.querySelector('#menu-template').innerHTML.trim();

// подготавливаем разметку, передав ее в специальную функцию, которая разбивает разметку по разделителям 
const template = Handlebars.compile(source); // тут функция с HTML разметкой и буфер который готов принять входныеданные для подстановки в "окна"


// в переменную markup запишем результат работы функции-шаблона template
// аргументом будет наш объект, из которого подставятся данные
const markup = template(menuData); // тут разметка с подставленными данными

// в HTML выбираем родителя, куда будем подсталять разметку с данными 
const container = document.querySelector('#menu-container');

// выведем туда результат  
container.insertAdjacementHTML ('afterbegin', markup);
```

### Helpers

Handlebars-хелпер представляет собой простой идентификатор, за которым следуют ноль или более параметров (через пробел). Каждый параметр представляет собой handlebars-выражение. Параметром хелпера может также являться простая строка, число или логическое значение. Хелпер производит определенные операции с параметрами и возвращает HTML код.

#### Встроенные хелперы 

Описание на [Handlebars](http://handlebarsjs.com/builtin_helpers.html)

### if 
используйте этот хелпер **для вывода блока по условию**. 
Если его аргумент возвращает false, undefined, null, "", 0, или [], блок **не будет** отрисован и перейдет дальше в else .

```javascript
<div class="entry">
  {{#if author}}
    <h1>{{firstName}} {{lastName}}</h1>
  {{else}}
    <h1>Автор неизвестен</h1>
  {{/if}}
</div>
```

### unless 
используйте этот хелпер как обратный хелперу if. 
Блок **будет выведен**, если выражение **вернет ложное значение**.

```javascript
<div class="entry">
  {{#unless license}}
  <h3 class="warning">ВНИМАНИЕ: Эта запись не имеет лицензии!</h3>
  {{/unless}}
</div>
```

### each 
используйте этот хелпер для перебора списков. работает аналогично циклу forEach
Внутри блока можно использовать thisссылку на элемент, который повторяется/текущий елемент 

```javascript
<ul class="people_list">
  {{#each контекст}}
    <li>{{this}}</li>  // ссылка на текущий елемент
    <li>{{поле контекста}}</li> // если более глубокая вложенность
   {{/each}}
</ul>
``` 
#### Собственные хелперы

Пользовательские хелперы должны быть зарегистрированы до того, как будет использован шаблон. Различают два типа пользовательских хелперов: хелперы-функции и хелперы-блоки.


[getinstance](https://getinstance.info/articles/tools/custom-handlebars-helpers/)
 

------------


### Альтернативные_источники

[Habr](https://habr.com/post/273581/)

[getinstance](https://getinstance.info/articles/tools/introduction-to-handlebars/)
